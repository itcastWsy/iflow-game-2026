<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ˜¥èŠ‚é©¬å¹´ç¥ç¦æµ·æŠ¥ç”Ÿæˆå™¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', 'SimHei', sans-serif;
            overflow: hidden;
            background: linear-gradient(135deg, #1a0000 0%, #2d0000 50%, #1a0000 100%);
            min-height: 100vh;
        }

        #canvas-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
        }

        .container {
            position: relative;
            z-index: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
        }

        .input-section {
            background: rgba(255, 215, 0, 0.1);
            backdrop-filter: blur(10px);
            border: 2px solid #ffd700;
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            box-shadow: 0 0 40px rgba(255, 215, 0, 0.3);
            animation: fadeIn 1s ease-in;
        }

        .input-section h1 {
            color: #ffd700;
            font-size: 2.5em;
            margin-bottom: 30px;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
        }

        .input-group {
            margin-bottom: 25px;
        }

        .input-group input {
            width: 300px;
            padding: 15px 25px;
            font-size: 1.2em;
            border: 2px solid #ffd700;
            border-radius: 50px;
            background: rgba(0, 0, 0, 0.5);
            color: #ffd700;
            text-align: center;
            outline: none;
            transition: all 0.3s ease;
        }

        .input-group input:focus {
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
            transform: scale(1.05);
        }

        .input-group input::placeholder {
            color: rgba(255, 215, 0, 0.5);
        }

        .btn {
            padding: 15px 40px;
            font-size: 1.2em;
            font-weight: bold;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #ffd700 0%, #ff6b35 100%);
            color: #8b0000;
            box-shadow: 0 5px 20px rgba(255, 215, 0, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 30px rgba(255, 215, 0, 0.6);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #ff4444 0%, #cc0000 100%);
            color: #ffd700;
            box-shadow: 0 5px 20px rgba(255, 68, 68, 0.4);
        }

        .btn-secondary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 30px rgba(255, 68, 68, 0.6);
        }

        .poster-section {
            display: none;
            text-align: center;
            animation: slideUp 0.8s ease-out;
        }

        .poster-canvas {
            background: linear-gradient(135deg, #8b0000 0%, #dc143c 50%, #8b0000 100%);
            border: 4px solid #ffd700;
            border-radius: 20px;
            box-shadow: 0 0 50px rgba(255, 215, 0, 0.5);
            margin: 20px 0;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .lantern-decoration {
            position: fixed;
            top: 20px;
            font-size: 3em;
            animation: swing 3s ease-in-out infinite;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
        }

        .lantern-left {
            left: 30px;
        }

        .lantern-right {
            right: 30px;
            animation-delay: 1.5s;
        }

        @keyframes swing {
            0%, 100% {
                transform: rotate(-5deg);
            }
            50% {
                transform: rotate(5deg);
            }
        }

        .firework-text {
            color: #ffd700;
            font-size: 1.5em;
            margin-top: 20px;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.8);
        }
    </style>
</head>
<body>
    <div id="canvas-container"></div>
    
    <div class="lantern-decoration lantern-left">ğŸ®</div>
    <div class="lantern-decoration lantern-right">ğŸ®</div>

    <div class="container">
        <div class="input-section" id="inputSection">
            <h1>ğŸ§§ æ˜¥èŠ‚é©¬å¹´ç¥ç¦æµ·æŠ¥ç”Ÿæˆå™¨ ğŸ§§</h1>
            <div class="input-group">
                <input type="text" id="nameInput" placeholder="è¯·è¾“å…¥æ‚¨çš„å§“å" maxlength="10">
            </div>
            <button class="btn btn-primary" onclick="generatePoster()">ç”Ÿæˆæµ·æŠ¥</button>
        </div>

        <div class="poster-section" id="posterSection">
            <canvas id="posterCanvas" class="poster-canvas" width="600" height="800"></canvas>
            <div class="firework-text" id="blessingText"></div>
            <div>
                <button class="btn btn-primary" onclick="generateNewPoster()">é‡æ–°ç”Ÿæˆ</button>
                <button class="btn btn-secondary" onclick="downloadPoster()">ä¸‹è½½æµ·æŠ¥</button>
                <button class="btn btn-primary" onclick="goBack()">è¿”å›è¾“å…¥</button>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        // é©¬å¹´ç¥ç¦è¯åº“
        const blessings = [
            "{name}ç¥ç¦é©¬å¹´å¤§å‰ï¼",
            "{name}ç¥æ‚¨é©¬å¹´é©¬åˆ°æˆåŠŸï¼",
            "{name}æ­ç¥é©¬å¹´é¾™é©¬ç²¾ç¥ï¼",
            "{name}æ„¿æ‚¨é©¬å¹´ä¸€é©¬å½“å…ˆï¼",
            "{name}ç¥ç¦é©¬å¹´ä¸‡äº‹å¦‚æ„ï¼",
            "{name}ç¥æ‚¨é©¬å¹´è´¢è¿äº¨é€šï¼",
            "{name}æ­ç¥é©¬å¹´èº«ä½“å¥åº·ï¼",
            "{name}æ„¿æ‚¨é©¬å¹´äº‹ä¸šæœ‰æˆï¼",
            "{name}ç¥ç¦é©¬å¹´é˜–å®¶å¹¸ç¦ï¼",
            "{name}ç¥æ‚¨é©¬å¹´å¿ƒæƒ³äº‹æˆï¼",
            "{name}æ­ç¥é©¬å¹´å‰ç¨‹ä¼¼é”¦ï¼",
            "{name}æ„¿æ‚¨é©¬å¹´æ­¥æ­¥é«˜å‡ï¼",
            "{name}ç¥ç¦é©¬å¹´è´¢æºå¹¿è¿›ï¼",
            "{name}ç¥æ‚¨é©¬å¹´ç¦æ˜Ÿé«˜ç…§ï¼",
            "{name}æ­ç¥é©¬å¹´ç¬‘å£å¸¸å¼€ï¼",
            "{name}æ„¿æ‚¨é©¬å¹´å¹³å®‰å–œä¹ï¼",
            "{name}ç¥ç¦é©¬å¹´äº”ç¦ä¸´é—¨ï¼",
            "{name}ç¥æ‚¨é©¬å¹´å‰ç¥¥å¦‚æ„ï¼",
            "{name}æ­ç¥é©¬å¹´å¥½è¿è¿è¿ï¼",
            "{name}æ„¿æ‚¨é©¬å¹´ç¦æ°”æ»¡æ»¡ï¼",
            "{name}ç¥ç¦é©¬å¹´é¹ç¨‹ä¸‡é‡Œï¼",
            "{name}ç¥æ‚¨é©¬å¹´é£é»„è…¾è¾¾ï¼",
            "{name}æ­ç¥é©¬å¹´å¤§å±•å®å›¾ï¼",
            "{name}æ„¿æ‚¨é©¬å¹´ç¦æ»¡äººé—´ï¼",
            "{name}ç¥ç¦é©¬å¹´æ˜¥é£å¾—æ„ï¼",
            "{name}ç¥æ‚¨é©¬å¹´é”¦ä¸Šæ·»èŠ±ï¼",
            "{name}æ­ç¥é©¬å¹´èŠ±å¼€å¯Œè´µï¼",
            "{name}æ„¿æ‚¨é©¬å¹´é‡‘ç‰æ»¡å ‚ï¼",
            "{name}ç¥ç¦é©¬å¹´ç¦å¦‚ä¸œæµ·ï¼",
            "{name}ç¥æ‚¨é©¬å¹´å¯¿æ¯”å—å±±ï¼"
        ];

        // æµ·æŠ¥èƒŒæ™¯æ¸å˜è‰²åº“
        const gradients = [
            ['#8b0000', '#dc143c', '#8b0000'],
            ['#000033', '#000066', '#000033'],
            ['#330000', '#660000', '#330000'],
            ['#1a0033', '#330066', '#1a0033'],
            ['#003300', '#006600', '#003300'],
            ['#660000', '#cc0000', '#660000'],
            ['#331a00', '#663300', '#331a00'],
            ['#001a33', '#003366', '#001a33']
        ];

        let userName = '';
        let currentBlessing = '';
        let currentGradient = [];
        let posterStyle = 0;

        // Three.js èƒŒæ™¯åŠ¨ç”»
        function initThreeJS() {
            const container = document.getElementById('canvas-container');
            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            const renderer = new THREE.WebGLRenderer({ alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            container.appendChild(renderer.domElement);

            // åˆ›å»ºç²’å­ç³»ç»Ÿï¼ˆé‡‘è‰²ç²’å­ï¼‰
            const particlesGeometry = new THREE.BufferGeometry();
            const particlesCount = 500;
            const posArray = new Float32Array(particlesCount * 3);

            for (let i = 0; i < particlesCount * 3; i++) {
                posArray[i] = (Math.random() - 0.5) * 10;
            }

            particlesGeometry.setAttribute('position', new THREE.BufferAttribute(posArray, 3));
            const particlesMaterial = new THREE.PointsMaterial({
                size: 0.05,
                color: 0xffd700,
                transparent: true,
                opacity: 0.8
            });
            const particlesMesh = new THREE.Points(particlesGeometry, particlesMaterial);
            scene.add(particlesMesh);

            // åˆ›å»ºç¯ç¬¼å‡ ä½•ä½“
            const lanternGroup = new THREE.Group();
            
            // åˆ›å»ºå‡ ä¸ªç¯ç¬¼
            for (let i = 0; i < 5; i++) {
                const lanternGeometry = new THREE.SphereGeometry(0.3, 32, 32);
                const lanternMaterial = new THREE.MeshBasicMaterial({ color: 0xff0000 });
                const lantern = new THREE.Mesh(lanternGeometry, lanternMaterial);
                lantern.position.set(
                    (Math.random() - 0.5) * 8,
                    (Math.random() - 0.5) * 6,
                    (Math.random() - 0.5) * 5
                );
                lanternGroup.add(lantern);
            }
            scene.add(lanternGroup);

            camera.position.z = 5;

            // åŠ¨ç”»å¾ªç¯
            function animate() {
                requestAnimationFrame(animate);
                
                particlesMesh.rotation.y += 0.001;
                particlesMesh.rotation.x += 0.0005;
                
                lanternGroup.rotation.y += 0.002;
                
                // ç¯ç¬¼æµ®åŠ¨æ•ˆæœ
                lanternGroup.children.forEach((lantern, index) => {
                    lantern.position.y += Math.sin(Date.now() * 0.001 + index) * 0.002;
                });

                renderer.render(scene, camera);
            }
            animate();

            // å“åº”çª—å£å¤§å°å˜åŒ–
            window.addEventListener('resize', () => {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            });
        }

        // ç”Ÿæˆç¥ç¦è¯
        function generateBlessing(name) {
            const randomIndex = Math.floor(Math.random() * blessings.length);
            return blessings[randomIndex].replace('{name}', name);
        }

        // ç”Ÿæˆæµ·æŠ¥
        function generatePoster() {
            const name = document.getElementById('nameInput').value.trim();
            if (!name) {
                alert('è¯·è¾“å…¥æ‚¨çš„å§“åï¼');
                return;
            }

            userName = name;
            currentBlessing = generateBlessing(name);
            posterStyle = Math.floor(Math.random() * 4);
            currentGradient = gradients[Math.floor(Math.random() * gradients.length)];

            drawPoster();
            
            document.getElementById('inputSection').style.display = 'none';
            document.getElementById('posterSection').style.display = 'block';
            document.getElementById('blessingText').textContent = currentBlessing;
        }

        // ç»˜åˆ¶æµ·æŠ¥
        function drawPoster() {
            const canvas = document.getElementById('posterCanvas');
            const ctx = canvas.getContext('2d');

            // æ¸…ç©ºç”»å¸ƒ
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // ç»˜åˆ¶èƒŒæ™¯æ¸å˜
            const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
            gradient.addColorStop(0, currentGradient[0]);
            gradient.addColorStop(0.5, currentGradient[1]);
            gradient.addColorStop(1, currentGradient[2]);
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // ç»˜åˆ¶è£…é¥°å…ƒç´ 
            drawDecorations(ctx, canvas);

            // ç»˜åˆ¶é©¬å¹´ä¸»é¢˜å›¾æ¡ˆ
            drawHorseTheme(ctx, canvas);

            // ç»˜åˆ¶ç¥ç¦è¯
            drawBlessing(ctx, canvas);
        }

        // ç»˜åˆ¶è£…é¥°å…ƒç´ 
        function drawDecorations(ctx, canvas) {
            // ç»˜åˆ¶è¾¹æ¡†
            ctx.strokeStyle = '#ffd700';
            ctx.lineWidth = 8;
            ctx.strokeRect(20, 20, canvas.width - 40, canvas.height - 40);

            // ç»˜åˆ¶è§’è½è£…é¥°
            const cornerSize = 60;
            ctx.fillStyle = '#ffd700';
            
            // å·¦ä¸Šè§’
            ctx.beginPath();
            ctx.moveTo(20, 20 + cornerSize);
            ctx.lineTo(20, 20);
            ctx.lineTo(20 + cornerSize, 20);
            ctx.lineTo(20 + cornerSize, 20 + cornerSize / 2);
            ctx.lineTo(20 + cornerSize / 2, 20 + cornerSize);
            ctx.closePath();
            ctx.fill();

            // å³ä¸Šè§’
            ctx.beginPath();
            ctx.moveTo(canvas.width - 20 - cornerSize, 20);
            ctx.lineTo(canvas.width - 20, 20);
            ctx.lineTo(canvas.width - 20, 20 + cornerSize);
            ctx.lineTo(canvas.width - 20 - cornerSize / 2, 20 + cornerSize);
            ctx.lineTo(canvas.width - 20 - cornerSize, 20 + cornerSize / 2);
            ctx.closePath();
            ctx.fill();

            // å·¦ä¸‹è§’
            ctx.beginPath();
            ctx.moveTo(20, canvas.height - 20 - cornerSize);
            ctx.lineTo(20, canvas.height - 20);
            ctx.lineTo(20 + cornerSize, canvas.height - 20);
            ctx.lineTo(20 + cornerSize, canvas.height - 20 - cornerSize / 2);
            ctx.lineTo(20 + cornerSize / 2, canvas.height - 20 - cornerSize);
            ctx.closePath();
            ctx.fill();

            // å³ä¸‹è§’
            ctx.beginPath();
            ctx.moveTo(canvas.width - 20 - cornerSize, canvas.height - 20);
            ctx.lineTo(canvas.width - 20, canvas.height - 20);
            ctx.lineTo(canvas.width - 20, canvas.height - 20 - cornerSize);
            ctx.lineTo(canvas.width - 20 - cornerSize / 2, canvas.height - 20 - cornerSize);
            ctx.lineTo(canvas.width - 20 - cornerSize, canvas.height - 20 - cornerSize / 2);
            ctx.closePath();
            ctx.fill();

            // ç»˜åˆ¶ç¯ç¬¼è£…é¥°
            drawLantern(ctx, 80, 100);
            drawLantern(ctx, canvas.width - 80, 100);
        }

        // ç»˜åˆ¶ç¯ç¬¼
        function drawLantern(ctx, x, y) {
            const size = 50;
            
            // ç¯ç¬¼ä¸»ä½“
            ctx.fillStyle = '#ff0000';
            ctx.beginPath();
            ctx.ellipse(x, y, size / 2, size, 0, 0, Math.PI * 2);
            ctx.fill();
            
            // ç¯ç¬¼é«˜å…‰
            ctx.fillStyle = 'rgba(255, 255, 255, 0.3)';
            ctx.beginPath();
            ctx.ellipse(x - 10, y - 15, size / 4, size / 3, -0.3, 0, Math.PI * 2);
            ctx.fill();
            
            // ç¯ç¬¼é¡¶éƒ¨
            ctx.fillStyle = '#ffd700';
            ctx.fillRect(x - 15, y - size - 5, 30, 10);
            
            // ç¯ç¬¼åº•éƒ¨
            ctx.fillRect(x - 15, y + size - 5, 30, 10);
            
            // æµè‹
            ctx.strokeStyle = '#ffd700';
            ctx.lineWidth = 2;
            for (let i = 0; i < 5; i++) {
                ctx.beginPath();
                ctx.moveTo(x - 10 + i * 5, y + size + 5);
                ctx.lineTo(x - 10 + i * 5, y + size + 30 + Math.random() * 10);
                ctx.stroke();
            }
        }

        // ç»˜åˆ¶é©¬å¹´ä¸»é¢˜
        function drawHorseTheme(ctx, canvas) {
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2 - 50;

            // ç»˜åˆ¶"é©¬"å­—
            ctx.save();
            ctx.translate(centerX, centerY);
            ctx.rotate(-0.1);
            
            ctx.font = 'bold 180px "Microsoft YaHei", "SimHei", sans-serif';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            
            // æ–‡å­—é˜´å½±
            ctx.shadowColor = 'rgba(0, 0, 0, 0.5)';
            ctx.shadowBlur = 20;
            ctx.shadowOffsetX = 5;
            ctx.shadowOffsetY = 5;
            
            // æ–‡å­—æ¸å˜
            const textGradient = ctx.createLinearGradient(-100, -90, 100, 90);
            textGradient.addColorStop(0, '#ffd700');
            textGradient.addColorStop(0.5, '#ff6b35');
            textGradient.addColorStop(1, '#ffd700');
            ctx.fillStyle = textGradient;
            
            ctx.fillText('é©¬', 0, 0);
            ctx.restore();

            // ç»˜åˆ¶"å¹´"å­—
            ctx.save();
            ctx.translate(centerX + 120, centerY + 80);
            
            ctx.font = 'bold 100px "Microsoft YaHei", "SimHei", sans-serif';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            
            ctx.shadowColor = 'rgba(0, 0, 0, 0.5)';
            ctx.shadowBlur = 15;
            ctx.shadowOffsetX = 3;
            ctx.shadowOffsetY = 3;
            
            ctx.fillStyle = '#ffd700';
            ctx.fillText('å¹´', 0, 0);
            ctx.restore();
        }

        // ç»˜åˆ¶ç¥ç¦è¯
        function drawBlessing(ctx, canvas) {
            const centerX = canvas.width / 2;
            const baseY = canvas.height - 180;

            ctx.save();
            
            // ç¥ç¦è¯èƒŒæ™¯
            ctx.fillStyle = 'rgba(0, 0, 0, 0.3)';
            ctx.fillRect(50, baseY - 40, canvas.width - 100, 80);
            
            ctx.strokeStyle = '#ffd700';
            ctx.lineWidth = 2;
            ctx.strokeRect(50, baseY - 40, canvas.width - 100, 80);

            // ç¥ç¦è¯æ–‡å­—
            ctx.font = 'bold 28px "Microsoft YaHei", "SimHei", sans-serif';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            
            ctx.shadowColor = 'rgba(255, 215, 0, 0.8)';
            ctx.shadowBlur = 10;
            ctx.shadowOffsetX = 2;
            ctx.shadowOffsetY = 2;
            
            ctx.fillStyle = '#ffd700';
            ctx.fillText(currentBlessing, centerX, baseY);
            
            ctx.restore();

            // ç»˜åˆ¶æ—¥æœŸ
            ctx.save();
            ctx.font = '16px "Microsoft YaHei", sans-serif';
            ctx.textAlign = 'center';
            ctx.fillStyle = 'rgba(255, 215, 0, 0.7)';
            ctx.fillText('äºŒã€‡äºŒå…­å¹´Â·é©¬å¹´', centerX, canvas.height - 30);
            ctx.restore();
        }

        // é‡æ–°ç”Ÿæˆæµ·æŠ¥
        function generateNewPoster() {
            currentBlessing = generateBlessing(userName);
            posterStyle = Math.floor(Math.random() * 4);
            currentGradient = gradients[Math.floor(Math.random() * gradients.length)];
            
            drawPoster();
            document.getElementById('blessingText').textContent = currentBlessing;
        }

        // ä¸‹è½½æµ·æŠ¥
        function downloadPoster() {
            const canvas = document.getElementById('posterCanvas');
            const link = document.createElement('a');
            link.download = `${userName}_é©¬å¹´ç¥ç¦æµ·æŠ¥.png`;
            link.href = canvas.toDataURL('image/png');
            link.click();
        }

        // è¿”å›è¾“å…¥é¡µé¢
        function goBack() {
            document.getElementById('posterSection').style.display = 'none';
            document.getElementById('inputSection').style.display = 'block';
            document.getElementById('nameInput').value = '';
        }

        // åˆå§‹åŒ–
        window.onload = function() {
            initThreeJS();
        };

        // å›è½¦é”®è§¦å‘ç”Ÿæˆ
        document.getElementById('nameInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                generatePoster();
            }
        });
    </script>
</body>
</html>